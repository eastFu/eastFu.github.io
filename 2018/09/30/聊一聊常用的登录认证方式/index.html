<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="聊一聊常用的登录认证方式"><meta name="keywords" content="其它"><meta name="author" content="EastFu,undefined"><meta name="copyright" content="EastFu"><title>聊一聊常用的登录认证方式 | EastFu's Blog</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.5.6"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.5.6"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/gh/upupming/gitalk@36368e5dffd049e956cdbbd751ff96c28d8255cf/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#常用的认证方式"><span class="toc-number">1.</span> <span class="toc-text">常用的认证方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth-认证"><span class="toc-number">1.1.</span> <span class="toc-text">OAuth 认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie-Session-认证"><span class="toc-number">1.2.</span> <span class="toc-text">Cookie-Session 认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie-Session-改造版"><span class="toc-number">1.3.</span> <span class="toc-text">Cookie-Session 改造版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于JWT的Token认证"><span class="toc-number">1.4.</span> <span class="toc-text">基于JWT的Token认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">1.5.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://raw.github.com/eastFu/docs/master/blog/hexo/head.jpg"></div><div class="author-info__name text-center">EastFu</div><div class="author-info__description text-center">买个闹钟，以便按时叫醒你</div><div class="follow-button"><a href="https://github.com/eastFu" target="_blank">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">22</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">13</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">7</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://ws1.sinaimg.cn/large/8700af19ly1fnp7q2phkzj21hc0xc0yl)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">EastFu's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/gallery">相册</a></span></div><div id="post-info"><div id="post-title">聊一聊常用的登录认证方式</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-30</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/随笔/">随笔</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2k</span><span class="post-meta__separator">|</span><span>Reading time: 6 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><blockquote>
<p>登录认证几乎是任何一个系统的标配，web 系统、APP、PC 客户端等，好多都需要注册、登录、授权认证。</p>
</blockquote>
<p>以一个电商系统，假设淘宝为例，如果我们想要下单，首先需要注册一个账号。拥有了账号之后，我们需要输入用户名（比如手机号或邮箱）、密码完成登录过程。之后如果你在一段时间内再次进入系统，是不需要输入用户名和密码的，只有在连续长时间不登录的情况下（例如一个月没登录过）访问系统，再次需要输入用户名和密码。如果使用频率很频繁，通常是一年都不用再输一次密码，所以经常在换了一台电脑或者一部手机之后，一些经常使用的网站或 APP 不记得密码了。</p>
<p>提炼出来整个过程大概就是如下几步：</p>
<blockquote>
<p>首次使用，需要通过邮箱或手机号注册；<br>注册完成后，需要提供用户名和密码完成登录；<br>下次再使用，通常不会再次输入用户名和密码即可直接进入系统并使用其功能（除非连续长时间未使用）；</p>
</blockquote>
<h2 id="常用的认证方式"><a href="#常用的认证方式" class="headerlink" title="常用的认证方式"></a>常用的认证方式</h2><h3 id="OAuth-认证"><a href="#OAuth-认证" class="headerlink" title="OAuth 认证"></a>OAuth 认证</h3><p>OAuth 认证比较常见的就是微信登录、微博登录、qq登录等，简单来说就是利用这些比较权威的网站或应用开放的 API 来实现用户登录，用户可以不用在你的网站或应用上注册账号，直接用已有的微信、微博、qq 等账号登录。</p>
<p>这一样一来，即省了用户注册的时间，又简化了你的系统的账号体系。从而既可以提高用户注册率可以节省开发时间，同时，安全性也有了保障。</p>
<p>维基百科对它的解释摘要如下：</p>
<blockquote>
<p>OAuth允许用户提供一个令牌，而不是用户名和密码来访问他们存放在特定服务提供者的数据。每一个令牌&gt;授权一个特定的网站（例如，视频编辑网站)在特定的时段（例如，接下来的2小时内）内访问特定的资源（例如仅仅是某一相册中的视频）。这样，OAuth让用户可以授权第三方网站访问他们存储在另外服务提供者的某些特定信息，而非所有内容。</p>
</blockquote>
<p>假设我们开发了一个电商平台，并集成了微信登录，以这个场景为例，说一下 OAuth 的工作原理。</p>
<p>讲之前需要了解其中涉及到的几个角色：</p>
<ul>
<li>用户：即使用我们平台的用户</li>
<li>用户终端：即最终用户使用的 APP 端或 web 端</li>
<li>应用服务器端：即我们的服务器端</li>
<li>授权服务器端：这里就是微信处理授权请求的服务器</li>
</ul>
<p>好的，接下来开始在我们的电商平台web端实现微信登录功能。微信网页授权是授权码模式（authorization code）的 OAuth 授权模式。</p>
<ol>
<li>我们电商平台的用户过来登录，常用场景是点击“微信登录”按钮；</li>
<li>接下来，用户终端将用户引导到微信授权页面；</li>
<li>用户同意授权，应用服务器重定向到之前设置好的 <strong>redirect_uri</strong> （应用服务器所在的地址），并附带上授权码（code）;</li>
<li>应用服务器用上一步获取的 code 向微信授权服务器发送请求，获取 <strong>access_token</strong>，也就是上面说的令牌；</li>
<li>之后应用服务器用上一步获取的 <strong>access_token</strong> 去请求微信授权服务器获取用户的基本信息，例如头像、昵称等；</li>
</ol>
<h3 id="Cookie-Session-认证"><a href="#Cookie-Session-认证" class="headerlink" title="Cookie-Session 认证"></a>Cookie-Session 认证</h3><p>早期互联网以 web 为主，客户端是浏览器，所以 Cookie-Session 方式最那时候最常用的方式，直到现在，一些 web 网站依然用这种方式做认证。</p>
<p><strong>认证过程大致如下：</strong></p>
<ol>
<li>用户输入用户名、密码或者用短信验证码方式登录系统；</li>
<li>服务端验证后，创建一个 Session 信息，并且将 SessionID 存到 cookie，发送回浏览器；</li>
<li>下次客户端再发起请求，自动带上 cookie 信息，服务端通过 cookie 获取 Session 信息进行校验；</li>
</ol>
<p><strong>弊端</strong></p>
<ul>
<li>只能在 web 场景下使用，如果是 APP 中，不能使用 cookie 的情况下就不能用了；</li>
<li>即使能在 web 场景下使用，也要考虑跨域问题，因为 cookie 不能跨域；</li>
<li>cookie 存在 CSRF（跨站请求伪造）的风险；</li>
<li>如果是分布式服务，需要考虑 Session 同步问题；</li>
</ul>
<h3 id="Cookie-Session-改造版"><a href="#Cookie-Session-改造版" class="headerlink" title="Cookie-Session 改造版"></a>Cookie-Session 改造版</h3><p>由于传统的 Cookie-Session 认证存在诸多问题，可以把上面的方案改造一下。改动的地方如下：</p>
<ul>
<li>不用 cookie 做客户端存储，改用其他方式，web 下使用 local storage，APP 中使用客户端数据库，这样就实现了跨域，并且避免了 CSRF ;</li>
<li>服务端也不存 Session 了，把 Session 信息拿出来存到 Redis 等内存数据库中，这样即提高了速度，又避免了 Session 同步问题；</li>
</ul>
<p>经过改造之后变成了如下的认证过程：</p>
<ol>
<li>用户输入用户名、密码或者用短信验证码方式登录系统；</li>
<li>服务端经过验证，将认证信息构造好的数据结构存储到 Redis 中，并将 key 值返回给客户端；</li>
<li>客户端拿到返回的 key，存储到 local storage 或本地数据库；</li>
<li>下次客户端再次请求，把 key 值附加到 header 或者 请求体中；</li>
<li>服务端根据获取的 key，到 Redis 中获取认证信息；</li>
</ol>
<h3 id="基于JWT的Token认证"><a href="#基于JWT的Token认证" class="headerlink" title="基于JWT的Token认证"></a>基于JWT的Token认证</h3><p>上面的方案虽然经过了改版，但还是需要客户端和服务器端维持一个状态信息，比如用 cookie 换 session ,或者用 key 换 Redis 的 value 信息，基于 JWT 的 Token 认证方案可以省去这个过程。</p>
<p>JSON Web Token（JWT）是一个非常轻巧的规范。这个规范允许我们使用JWT在用户和服务器之间传递安全可靠的信息。</p>
<p><strong>认证过程</strong></p>
<ol>
<li>依然是用户登录系统；</li>
<li>服务端验证，将认证信息通过指定的算法（例如HS256）进行加密，例如对用户名和用户所属角色进行加密，加密私钥是保存在服务器端的，将加密后的结果发送给客户端，加密的字符串格式为三个”.” 分隔的字符串 Token，分别对应头部、载荷与签名，头部和载荷都可以通过 base64 解码出来，签名部分不可以；</li>
<li>客户端拿到返回的 Token，存储到 local storage 或本地数据库；</li>
<li>下次客户端再次发起请求，将 Token 附加到 header 中；</li>
<li>服务端获取 header 中的 Token ，通过相同的算法对 Token 中的用户名和所属角色进行相同的加密验证，如果验证结果相同，则说明这个请求是正常的，没有被篡改。这个过程可以完全不涉及到查询 Redis 或其他存储；</li>
</ol>
<p><strong>优点</strong></p>
<ul>
<li>使用 json 作为数据传输，有广泛的通用型，并且体积小，便于传输；</li>
<li>不需要在服务器端保存相关信息；</li>
<li>jwt 载荷部分可以存储业务相关的信息（非敏感的），例如用户信息、角色等；</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>综上所述，JWT 可以作为首选的认证方案。当然，具体的情况具体分析，还要看是不是适合真实的应用场景。除了上述的这些，涉及到信息安全的，建议全部采用 https 方式部署，采用 https 方式，信息很难被嗅探破解，对应用的安全性很重要。</p>
<p><strong>参考信息：</strong></p>
<p>OAuth: <a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html</a></p>
<p>JWT：<a href="https://jwt.io/introduction/ http://blog.leapoahead.com/2015/09/06/understanding-jwt/" target="_blank" rel="noopener">https://jwt.io/introduction/ http://blog.leapoahead.com/2015/09/06/understanding-jwt/</a></p>
<p>JWT Java 库: <a href="https://github.com/jwtk/jjwt" target="_blank" rel="noopener">https://github.com/jwtk/jjwt</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">EastFu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://eastFu.top/2018/09/30/聊一聊常用的登录认证方式/">http://eastFu.top/2018/09/30/聊一聊常用的登录认证方式/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/其它/">其它</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/10/10/初识RabbitMQ/"><i class="fa fa-chevron-left">  </i><span>初识RabbitMQ</span></a></div><div class="next-post pull-right"><a href="/2018/09/27/一款非常好用的markdown编辑器-Haroopad/"><span>一款非常好用的markdown编辑器 : Haroopad</span><i class="fa fa-chevron-right"></i></a></div></nav><div class="post-adv"></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '8c2142af205d4703aa00',
  clientSecret: 'f4c1e68085e522938126fa1ff0d47d50ffa4d677',
  repo: 'eastFu.github.io',
  owner: 'eastFu',
  admin: 'eastFu',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2011 - 2018 By EastFu</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.6"></script><script src="/js/fancybox.js?version=1.5.6"></script><script src="/js/sidebar.js?version=1.5.6"></script><script src="/js/copy.js?version=1.5.6"></script><script src="/js/fireworks.js?version=1.5.6"></script><script src="/js/transition.js?version=1.5.6"></script><script src="/js/scroll.js?version=1.5.6"></script><script src="/js/head.js?version=1.5.6"></script></body></html>